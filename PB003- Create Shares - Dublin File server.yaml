---
- hosts: "{{ sourceserver }}"
  gather_facts: no
  tasks:

  - name: Dublin Applications Share
    win_share:
      name: Applications
      description: Dublin Applications File Share
      path: E:\Applications
      list: no
      full: Administrators,Global\FIL_ACL_DUB_Applications_F
      read: u49162
    when: (tasktype == "Build_Service") or (tasktype == "failover")
    
  - name: Dublin Home Share
    win_share:
      name: Home
      description: Dublin Home File Share
      path: E:\Home
      list: no
      full: Administrators,Global\FIL_ACL_DUB_Home_F
      read: u49162
    when: (tasktype == "Build_Service") or (tasktype == "failover")

  - name: Disable inherited ACL's for E:\
    win_acl_inheritance:
      path: E:\
      state: absent  
      
  - name: Remove NTFS ACL's on Root Volume. Everyone - ExecuteFile,Read
    win_acl:
      user: Everyone
      path: E:\
      type: allow
      state: absent
      rights: ExecuteFile,Read
    when: (tasktype == "Build_Service") or (tasktype == "failover")  
      
  - name: Remove NTFS ACL's on Root Volume. Users
    win_acl:
      user: Users
      path: E:\
      type: allow
      state: absent
      rights: CreateDirectories,AppendData,CreateFiles,ExecuteFile,ListDirectory,Traverse,ReadData,Read,ReadAttributes,ReadExtendedAttributes,ReadPermissions
    when: (tasktype == "Build_Service") or (tasktype == "failover")     
    
  - name: Remove NTFS ACL's on Root Volume. Users - CreateDirectories,AppendData
    win_acl:
      user: Users
      path: E:\
      type: allow
      state: absent
      rights: CreateDirectories,AppendData
    when: (tasktype == "Build_Service") or (tasktype == "failover")
      
  - name: Win_shell Remove NTFS ACL's on Root Volume. Users all perms.
    win_shell:
      icacls  e:\ /remove users /T
    when: (tasktype == "Build_Service") or (tasktype == "failover")
    
  - name: Add NTFS ACL's on Root Volume. Global\FIL_ACLROOT_DRV-E_DUB_F ExecuteFile,Read
    win_acl:
      user: Global\FIL_ACLROOT_DRV-E_DUB_F
      path: E:\
      type: allow
      rights: FullControl
    when: (tasktype == "Build_Service") or (tasktype == "failover")
    
      
  - name: Add NTFS ACLS's Read and Execute on Aplications Folder. Global\FIL_ACL_DUB_Applications_RX ExecuteFile,Read
    win_acl:
      user: Global\FIL_ACL_DUB_Applications_RX
      path: E:\Applications
      type: allow
      rights: ExecuteFile,Read
    when: (tasktype == "Build_Service") or (tasktype == "failover")
